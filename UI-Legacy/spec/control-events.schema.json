{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://pockethive.dev/docs/spec/control-events.schema.json",
  "title": "PocketHive Control Event",
  "type": "object",
  "required": ["event", "kind", "version", "role", "instance", "messageId", "timestamp"],
  "properties": {
    "event": { "type": "string", "enum": ["status", "lifecycle", "metric", "alert", "link"] },
    "kind": { "type": "string" },
    "version": { "type": "string" },
    "role": { "type": "string", "enum": ["generator", "moderator", "processor"] },
    "instance": { "type": "string" },
    "location": { "type": "string" },
    "messageId": { "type": "string", "format": "uuid" },
    "timestamp": { "type": "string", "format": "date-time" },
    "traffic": { "type": "string" },
    "queues": {
      "type": "object",
      "properties": {
        "in":  { "type": "array", "items": { "type": "string" } },
        "out": { "type": "array", "items": { "type": "string" } }
      }
    },
    "data": { "type": "object", "additionalProperties": true }
  },
  "allOf": [
    {
      "if": { "properties": { "kind": { "const": "status-full" } } },
      "then": { "properties": { "data": { "type": "object", "required": ["tps"] } } }
    },
    {
      "if": { "properties": { "kind": { "const": "status-delta" } } },
      "then": { "properties": { "data": { "type": "object", "required": ["tps"] } } }
    }
  ]
}
