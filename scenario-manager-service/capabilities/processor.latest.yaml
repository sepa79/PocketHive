schemaVersion: "1.0"
capabilitiesVersion: "1.1"
role: processor
image:
  name: processor
  tag: latest
ui:
  label: "Processor"
  color: "#a855f7"
  shape: "diamond"
  abbreviation: "PR"
  # HTTP processor configuration model:
  # - mode:
  #     - THREAD_COUNT: cap concurrency per instance to `threadCount` in-flight HTTP calls.
  #       The Rabbit worker adapter uses a bounded executor with no backlog so messages
  #       stay queued in Rabbit when all threads are busy.
  #     - RATE_PER_SEC: pace calls to approximately `ratePerSec` requests per second
  #       across the instance, still honouring `threadCount` as a hard max-in-flight cap.
  #       Pacing delay is not counted in the reported call latency.
  # - threadCount: desired concurrent HTTP calls per worker instance. When there is enough
  #   work available, the processor will maintain up to this many in-flight requests.
  # - ratePerSec: target calls per second in RATE_PER_SEC mode. This is shared across HTTP and TCP
  #   calls so control-plane guards can adjust a single knob regardless of protocol mix.
  # - keepAlive + connectionReuse:
  #     - keepAlive=true, connectionReuse=GLOBAL:
  #         - Shared Apache HttpClient connection pool with up to 200 total / 200 per route
  #           connections (also exposed as httpMaxConnections in runtime status).
  #     - keepAlive=true, connectionReuse=PER_THREAD:
  #         - One keep-alive HttpClient per worker thread, so effective max connections is
  #           ~threadCount.
  #     - keepAlive=false or connectionReuse=NONE:
  #         - No keep-alive; each HTTP call uses a fresh connection and closes it afterwards.
  # - TCP connection reuse:
  #     - tcpTransport.keepAlive + tcpTransport.connectionReuse are currently honoured only
  #       by the `socket` transport. `nio` and `netty` open a new connection per request.
  # - TCP TLS support:
  #     - `tcps://` is supported by `socket` and `netty`. `nio` is plaintext only.
  # - Observability:
  #     - Each call records:
  #         - x-ph-processor-duration-ms: time spent in the HTTP call itself (no pacing delay).
  #         - x-ph-processor-connection-latency-ms: time spent waiting for RATE_PER_SEC pacing.
  #     - Runtime status includes:
  #         - httpMode, httpThreadCount, httpMaxConnections, transactions, successRatio,
  #           avgLatencyMs (average HTTP call latency).
config:
  - name: inputs.type
    type: string
    default: "RABBITMQ"
    options:
      - "RABBITMQ"
      - "REDIS_DATASET"
  - name: outputs.type
    type: string
    default: "RABBITMQ"
    options:
      - "RABBITMQ"
      - "NOOP"
  - name: enabled
    type: boolean
    default: false
  - name: baseUrl
    type: string
    default: ""
  - name: mode
    type: string
    default: "THREAD_COUNT"
    options:
      - "THREAD_COUNT"
      - "RATE_PER_SEC"
  - name: threadCount
    type: int
    default: 1
  - name: ratePerSec
    type: double
    default: 1.0
  - name: keepAlive
    type: boolean
    default: true
  - name: connectionReuse
    type: string
    default: "GLOBAL"
    options:
      - "GLOBAL"
      - "PER_THREAD"
      - "NONE"
  - name: timeoutMs
    type: int
    default: 30000
  - name: sslVerify
    type: boolean
    default: false
  - name: tcpTransport.type
    type: string
    default: "socket"
    options:
      - "socket"
      - "nio"
      - "netty"
  - name: tcpTransport.timeout
    type: int
    default: 30000
  - name: tcpTransport.maxBytes
    type: int
    default: 8192
  - name: tcpTransport.keepAlive
    type: boolean
    default: true
  - name: tcpTransport.workerThreads
    type: int
    default: 4
  - name: tcpTransport.tcpNoDelay
    type: boolean
    default: true
  - name: tcpTransport.sslVerify
    type: boolean
    default: false
  - name: tcpTransport.connectionReuse
    type: string
    default: "GLOBAL"
    options:
      - "GLOBAL"
      - "PER_THREAD"
      - "NONE"
  - name: tcpTransport.maxRetries
    type: int
    default: 2
actions: []
panels: []
