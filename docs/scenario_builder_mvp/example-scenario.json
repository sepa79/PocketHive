{
  "id": "checkout-peak",
  "name": "Checkout Peak",
  "version": "0.1.0",
  "description": "Two swarms coordinated with a gate opening signal",
  "metadata": {
    "owner": "qa-team",
    "labels": [
      "mvp",
      "peak"
    ]
  },
  "assets": {
    "suts": [
      {
        "id": "shop-api",
        "name": "Shop API",
        "baseUrls": [
          "https://sut.example.com"
        ],
        "endpoints": [
          {
            "id": "getItem",
            "name": "Get Item",
            "method": "GET",
            "path": "/api/items/{id}",
            "timeoutMs": 3000
          },
          {
            "id": "checkout",
            "name": "Checkout",
            "method": "POST",
            "path": "/api/checkout",
            "timeoutMs": 8000
          }
        ],
        "authProfileRef": "oidc-default"
      }
    ],
    "datasets": [
      {
        "id": "users",
        "name": "Users Redis",
        "provider": {
          "type": "redis",
          "redis": {
            "keys": [
              "ph:dataset:users:*"
            ],
            "namespace": "ph:dataset"
          }
        },
        "bindings": [
          {
            "field": "userId",
            "source": "id"
          }
        ]
      }
    ],
    "swarmTemplates": [
      {
        "id": "browse-template",
        "name": "Browse",
        "roles": {
          "generator": true,
          "moderator": true,
          "processor": true,
          "postProcessor": true
        },
        "generator": {
          "maxConcurrency": 200,
          "thinkTimeMs": 200,
          "jitterPct": 0.1
        },
        "processor": {
          "sutRef": "shop-api",
          "endpointRef": "getItem",
          "headers": {
            "Accept": "application/json"
          }
        }
      },
      {
        "id": "checkout-template",
        "name": "Checkout",
        "roles": {
          "generator": true,
          "moderator": true,
          "processor": true,
          "postProcessor": true
        },
        "generator": {
          "maxConcurrency": 100,
          "thinkTimeMs": 500,
          "jitterPct": 0.2
        },
        "processor": {
          "sutRef": "shop-api",
          "endpointRef": "checkout",
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    ]
  },
  "scenario": {
    "schedule": {
      "startAt": "2025-10-01T09:00:00Z"
    },
    "runConfig": {
      "runPrefix": "mvp-peak",
      "allowParallel": true
    },
    "tracks": [
      {
        "name": "Browsing Swarm",
        "templateRef": "browse-template",
        "datasetRef": "users",
        "instances": 2,
        "blocks": [
          {
            "type": "Ramp",
            "rateFrom": 10,
            "rateTo": 100,
            "durationSec": 120
          },
          {
            "type": "Hold",
            "rate": 100,
            "durationSec": 300
          },
          {
            "type": "Signal",
            "name": "open-checkout",
            "atOffsetSec": 0
          },
          {
            "type": "Hold",
            "rate": 60,
            "durationSec": 300
          },
          {
            "type": "Pause",
            "durationSec": 30
          }
        ]
      },
      {
        "name": "Checkout Swarm",
        "templateRef": "checkout-template",
        "datasetRef": "users",
        "instances": 1,
        "blocks": [
          {
            "type": "WaitFor",
            "signal": "open-checkout",
            "timeoutSec": 600
          },
          {
            "type": "Ramp",
            "rateFrom": 5,
            "rateTo": 50,
            "durationSec": 60
          },
          {
            "type": "Hold",
            "rate": 50,
            "durationSec": 420
          },
          {
            "type": "Spike",
            "rate": 120,
            "durationSec": 60
          }
        ]
      }
    ]
  }
}