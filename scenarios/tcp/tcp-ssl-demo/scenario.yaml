id: tcp-ssl-demo
name: TCP SSL/TLS Secure Demo
description: Demonstrates secure TCP communication using TLS with certificate verification options
template:
  image: swarm-controller:latest
  bees:
    - role: generator
      image: generator:latest
      config:
        inputs:
          type: SCHEDULER
          scheduler:
            ratePerSec: 2
            maxMessages: 10
        worker:
          message:
            bodyType: SIMPLE
            body: |
              {
                "sessionId": "SEC_{{ eval('#uuid()') }}",
                "encryptedData": "{{ eval("#base64_encode('Sensitive data: ' + #randInt(1000, 9999))") }}",
                "signature": "{{ eval("#hmac_sha256_hex('secretkey', payload.sessionId)") }}",
                "timestamp": "{{ eval("#date_format(now, 'yyyy-MM-dd''T''HH:mm:ss.SSS''Z''')") }}"
              }
            headers:
              x-ph-call-id: secure-message
      work:
        out:
          out: build
    - role: request-builder
      image: request-builder:latest
      config:
        worker:
          templateRoot: /app/scenario/templates/tcp
          serviceId: secure
      work:
        in:
          in: build
        out:
          out: proc
    - role: processor
      image: processor:latest
      config:
        baseUrl: "{{ sut.endpoints['tcps-server'].baseUrl }}"
        worker:
          tcpTransport:
            type: socket
            connectionReuse: PER_THREAD
            maxRetries: 2
            connectTimeoutMs: 5000
            readTimeoutMs: 8000
      work:
        in:
          in: proc
        out:
          out: post
    - role: postprocessor
      image: postprocessor:latest
      config:
        worker:
          postprocessor:
            publish-all-metrics: true
      work:
        in:
          in: post
plan:
  bees:
    - role: generator
      steps:
        - stepId: gen-start
          name: Start generator
          time: PT1S
          type: start
  swarm:
    - stepId: swarm-start
      name: Start swarm
      time: PT0S
      type: start
