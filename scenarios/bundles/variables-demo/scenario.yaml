id: variables-demo
name: Scenario Variables Demo (vars.* + eval)
description: Demonstrates Scenario Variables injected as config.vars -> WorkItem header vars -> Pebble/SpEL usage.
template:
  image: swarm-controller:latest
  bees:
    - role: generator
      image: generator:latest
      config:
        inputs:
          scheduler:
            ratePerSec: 2
            maxMessages: 5
        worker:
          message:
            bodyType: HTTP
            path: /test
            method: POST
            body: |
              {
                "customerId": "{{ vars.customerId }}",
                "loopCount": {{ vars.loopCount }},
                "loopPlusOne": {{ eval("vars.loopCount + 1") }},
                "enableFoo": {{ vars.enableFoo }},
                "profile": "{{ vars.profile }}"
              }
            headers:
              content-type: application/json
              x-ph-customer-id: "{{ vars.customerId }}"
              x-ph-loop-plus-one: "{{ eval(\"vars.loopCount + 1\") }}"
      work:
        out:
          out: gen
    - role: moderator
      image: moderator:latest
      work:
        in:
          in: gen
        out:
          out: mod
    - role: processor
      image: processor:latest
      config:
        worker:
          baseUrl: "{{ sut.endpoints['default'].baseUrl }}/api"
      work:
        in:
          in: mod
        out:
          out: final
